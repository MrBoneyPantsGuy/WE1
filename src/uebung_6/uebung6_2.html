<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Uebung 6.2</title>
</head>
<body>
    <div id="content"></div>
</body>
<script>
    "use strict";

    async function getData() {
        let url = 'plagiatsresolution.html'; // fetched from local file in the same directory as the script
        let response = await fetch(url);
        let reponseText = await response.text();

        document.getElementById("content").innerHTML = reponseText; // display HTML structure on screen inside content area
        return reponseText;
    }

    function removeTags(str) {
        return ((str===null) || (str==='')) ? false : str.toString().replace( /(<([^>]+)>)/ig, ''); // replace HTML-Tags in string with nothing ("")
    }

    function excludeStopwords (element)  {
        let stopWords =  ["der", "die", "das", "den", "des", "einer", "eine", "eines", "und", "oder", "doch", "weil", "an", "in", "von", "nicht"];
        return (stopWords.find(word => word.includes(element.toLowerCase())) === undefined);
    }

    function mostOccurence(object) {
        return Object.keys(object).sort(function (a, b) {
            return object[a] - object[b]
        });
    }

    (async() => {
        let wordCounter = {};
        let data = await getData();                             // get the actual data as a string
        let cleanData = removeTags(data);                       // remove all <tags> from the string
        cleanData = cleanData.replace(/(\r\n|\n|\r)/gm, "");    // remove all linebreaks from the string
        cleanData.split(" ")                                    // split the string into single words as array
                .filter(x => x.trim())                          // remove any whitespace at start and end of the element
                .filter(excludeStopwords)                       // remove any stopWords
                .forEach(element => {                           // count occurences of each word
                    wordCounter[element] = wordCounter[element] ? wordCounter[element] + 1 : 1;
                });
        let words = mostOccurence(wordCounter);                 // sort words ascending
        console.log(Object.values(words).slice(Object.values(wordCounter).length-3)); // return the last 3 elements of most occurring words
    })();

</script>
</html>